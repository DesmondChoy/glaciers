count(company, year) %>%
view()
df %>%
filter(company == "NetEase") %>%
distinct(date)
df %>%
filter(company == "NetEase") %>%
distinct(date) %>%
view()
df %>%
distinct(date, .keep_all = TRUE) %>%
mutate(year = year(date)) %>%
count(company, year) %>%
view()
df %>%
filter(company == "NetEase") %>%
distinct(date) %>%
view()
df %>%
mutate(year = year(date)) %>%
count(company, year) %>%
view()
df %>%
group_by(company) %>%
distinct(date, .keep_all = T) %>%
mutate(year = year(date))
df %>%
group_by(company) %>%
distinct(date, .keep_all = T) %>%
mutate(year = year(date)) %>%
count(company, year) %>%
view()
df %>%
group_by(company) %>%
distinct(date, .keep_all = T) %>%
mutate(year = year(date)) %>%
count(company, year)
df %>%
group_by(company) %>%
distinct(date, .keep_all = T) %>%
mutate(year = year(date)) %>%
count(company, year) %>%
filter(!n == 4)
df %>%
group_by(company) %>%
distinct(date, .keep_all = T) %>%
mutate(year = year(date)) %>%
count(company, year) %>%
filter(!n == 4) %>%
arrange(year)
df %>%
group_by(company) %>%
distinct(date, .keep_all = T) %>%
mutate(year = year(date)) %>%
count(company, year) %>%
filter(!n == 4) %>%
arrange(year)
blogdown:::serve_site()
df
df %>%
group_by(company) %>%
distinct(date, .keep_all = T) %>%
mutate(year = year(date)) %>%
count(company, year) %>%
filter(!n == 4) %>%
arrange(year)
df %>%
group_by(company) %>%
distinct(date, .keep_all = T) %>%
mutate(year = year(date)) %>%
count(company, year) %>%
arrange(year)
df %>%
group_by(company) %>%
distinct(date, .keep_all = T) %>%
mutate(year = year(date)) %>%
count(company, year) %>%
arrange(year) %>%
print(n = 20)
library(tidyverse)
library(tidymodels)
?tidy
rankings <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-04-14/rankings.csv")
rankings %>%
ggplot(aes(year, points, color = gender)) +
geom_jitter(alpha = 0.7) +
scale_y_log10() +
labs(
y = "Critic rating",
x = NULL,
color = NULL
)
theme_set(theme_minimal())
rankings %>%
ggplot(aes(year, points, color = gender)) +
geom_jitter(alpha = 0.7) +
scale_y_log10() +
labs(
y = "Critic rating",
x = NULL,
color = NULL
)
rankings
library(spotifyr)
access_token <- get_spotify_access_token()
playlist_features <- get_playlist_audio_features("tmock1923", "7esD007S7kzeSwVtcH9GFe")
playlist_features
access_token
pull_id <- function(query) {
search_spotify(query, "track") %>%
arrange(-popularity) %>%
filter(row_number() == 1) %>%
pull(id)
}
ranking_ids <- rankings %>%
mutate(
search_query = paste(title, artist),
search_query = str_to_lower(search_query),
search_query = str_remove(search_query, "ft.*$")
) %>%
mutate(id = map_chr(search_query, possibly(pull_id, NA_character_)))
ranking_ids %>%
select(title, artist, id)
ranking_ids %>%
select(title, artist, id)
ranking_ids
ranking_ids %>%
na.omit()
ranking_ids %>%
filter(id == is.na())
ranking_ids %>%
filter(id == is.na(.))
ranking_ids %>%
filter(id == "NA")
ranking_ids %>%
filter(id == NA)
ranking_ids %>%
skimr::skim()
library(skimr)
ranking_ids %>%
n_empty()
ranking_ids %>%
n_empty(id)
ranking_ids %>%
select(id) %>%
n_empty()
?n_empty
ranking_ids %>% n_empty()
ranking_ids %>% n_missing()
ranking_ids %>%
filter(id == n_missing())
ranking_ids %>%
filter(n_missing(id))
ranking_ids %>%
n_missing() %>%
pull(title)
ranking_ids %>%
!drop_na()
ranking_ids %>%
drop_na()
ranking_ids %>%
filter(is.na(id))
ranking_ids %>%
filter(is.na(id)) %>%
pull(title, artist, id)
ranking_ids %>%
filter(is.na(id)) %>%
pull(title)
ranking_ids %>%
filter(drop_na(id)) %>%
pull(title)
possibly
ranking_features <- ranking_ids %>%
mutate(id_group = row_number() %/% 80) %>%
select(id_group, id) %>%
nest(data = c(id)) %>%
mutate(audio_features = map(data, ~ get_track_audio_features(.$id)))
ranking_df <- ranking_ids %>%
bind_cols(ranking_features %>%
select(audio_features) %>%
unnest(audio_features)) %>%
select(title, artist, points, year, danceability:tempo) %>%
na.omit()
ranking_df
library(corrr)
install.packages("corrr")
library(corrr)
ranking_df %>%
select(year:tempo) %>%
correlate()
ranking_df
ranking_df %>%
correlate()
ranking_df %>%
select(points:tempo) %>%
correlate()
ranking_df %>%
select(year:tempo) %>%
correlate()
ranking_df %>%
select(year:tempo) %>%
correlate() %>%
rearrange()
ranking_df %>%
select(year:tempo) %>%
correlate() %>%
rearrange() %>%
shave()
ranking_df %>%
select(year:tempo) %>%
correlate() %>%
rearrange() %>%
shave() %>%
rplot(shape = 15, colours = c("darkorange", "white", "darkcyan"))
ranking_lm <- ranking_df %>%
select(-title, -artist) %>%
lm(log(points) ~ ., data = .)
ranking_lm
summary(ranking_lm)
ranking_rec <- recipe(points ~ ., data = ranking_df) %>%
update_role(title, artist, new_role = "id") %>%
step_log(points) %>%
step_normalize(all_predictors()) %>%
step_pca(all_predictors())
ranking_prep <- prep(ranking_rec)
ranking_prep
?update_role
ranking_prep
tidy(ranking_prep)
ranking_prep <- prep(ranking_rec)
tidy(ranking_prep)
tidy(ranking_prep, 3)
library(tidyverse)
library(tidymodels)
tidy(ranking_prep)
rankings <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-04-14/rankings.csv")
rankings %>%
ggplot(aes(year, points, color = gender)) +
geom_jitter(alpha = 0.7) +
scale_y_log10() +
labs(
y = "Critic rating",
x = NULL,
color = NULL
)
library(spotifyr)
access_token <- get_spotify_access_token()
playlist_features <- get_playlist_audio_features("tmock1923", "7esD007S7kzeSwVtcH9GFe")
pull_id <- function(query) {
search_spotify(query, "track") %>%
arrange(-popularity) %>%
filter(row_number() == 1) %>%
pull(id)
}
ranking_ids <- rankings %>%
mutate(
search_query = paste(title, artist),
search_query = str_to_lower(search_query),
search_query = str_remove(search_query, "ft.*$")
) %>%
mutate(id = map_chr(search_query, possibly(pull_id, NA_character_)))
ranking_ids %>%
filter(drop_na(id)) %>%
pull(title)
ranking_features <- ranking_ids %>%
mutate(id_group = row_number() %/% 80) %>%
select(id_group, id) %>%
nest(data = c(id)) %>%
mutate(audio_features = map(data, ~ get_track_audio_features(.$id)))
ranking_df <- ranking_ids %>%
bind_cols(ranking_features %>%
select(audio_features) %>%
unnest(audio_features)) %>%
select(title, artist, points, year, danceability:tempo) %>%
na.omit()
ranking_df
library(corrr)
ranking_df %>%
select(year:tempo) %>%
correlate() %>%
rearrange() %>%
shave() %>%
rplot(shape = 15, colours = c("darkorange", "white", "darkcyan"))
ranking_lm <- ranking_df %>%
select(-title, -artist) %>%
lm(log(points) ~ ., data = .)
ranking_rec <- recipe(points ~ ., data = ranking_df) %>%
update_role(title, artist, new_role = "id") %>%
step_log(points) %>%
step_normalize(all_predictors()) %>%
step_pca(all_predictors())
ranking_prep <- prep(ranking_rec)
tidy(ranking_prep)
?tidy
recipes::tidy(ranking_prep)
recipes::tidy(ranking_prep, 2)
recipes::tidy(ranking_prep, 8)
?recipes::tidy
recipes::tidy(ranking_prep)
recipes::tidy(ranking_prep, 1)
recipes::tidy(ranking_prep, 2)
recipes::tidy(ranking_prep, 3)
tidied_pca <- tidy(ranking_prep, 3)
fct_inorder
tidied_pca %>%
mutate(component = fct_inorder(component)) %>%
ggplot(aes(value, terms, fill = terms)) +
geom_col(show.legend = FALSE) +
facet_wrap(~component) +
labs(y = NULL)
tidied_pca <- tidy(ranking_prep, 3)
tidied_pca <- recipes::tidy(ranking_prep, 3)
tidied_pca %>%
mutate(component = fct_inorder(component)) %>%
ggplot(aes(value, terms, fill = terms)) +
geom_col(show.legend = FALSE) +
facet_wrap(~component) +
labs(y = NULL)
theme_set(theme_minimal())
library(fishualize)
tidied_pca %>%
mutate(component = fct_inorder(component)) %>%
ggplot(aes(value, terms, fill = terms)) +
geom_col(show.legend = FALSE) +
facet_wrap(~component) +
labs(y = NULL) +
scale_fill_fish_d(option = "Antennarius_commerson") +
tidied_pca %>%
mutate(component = fct_inorder(component)) %>%
ggplot(aes(value, terms, fill = terms)) +
geom_col(show.legend = FALSE) +
facet_wrap(~component) +
labs(y = NULL) +
scale_fill_fish_d(option = "Antennarius_commerson")
library(tidytext)
tidy(ranking_prep)
tidied_pca %>%
filter(component %in% c("PC1", "PC2", "PC3", "PC4")) %>%
group_by(component) %>%
top_n(6, abs(value)) %>%
ungroup()
tidied_pca %>%
filter(component %in% c("PC1", "PC2", "PC3", "PC4")) %>%
group_by(component) %>%
top_n(6, abs(value)) %>%
ungroup() %>%
mutate(terms = reorder_within(terms, abs(value), component)) %>%
ggplot(aes(abs(value), terms, fill = value > 0)) +
geom_col() +
facet_wrap(~component, scales = "free_y") +
scale_y_reordered() +
labs(
x = "Absolute value of contribution",
y = NULL, fill = "Positive?"
) +
scale_fill_fish_d(option = "Antennarius_commerson")
juice(ranking_prep)
juice(ranking_prep) %>%
ggplot(aes(PC1, PC2, label = title)) +
geom_point(alpha = 0.2) +
geom_text(check_overlap = TRUE)
juice(ranking_prep) %>%
ggplot(aes(PC1, PC2, label = title)) +
geom_point(alpha = 0.2) +
geom_text(check_overlap = TRUE, family = "IBMPlexSans")
juice(ranking_prep) %>%
ggplot(aes(PC1, PC2, label = title)) +
geom_point(alpha = 0.2) +
geom_text(check_overlap = TRUE)
juice(ranking_prep) %>%
ggplot(aes(PC1, PC2, label = title)) +
geom_point(alpha = 0.2) +
geom_text(check_overlap = TRUE, family = "IBMPlexSans")
tidied_pca %>%
filter(component %in% c("PC1", "PC2", "PC3", "PC4")) %>%
group_by(component) %>%
top_n(6, abs(value)) %>%
ungroup() %>%
mutate(terms = reorder_within(terms, abs(value), component)) %>%
ggplot(aes(abs(value), terms, fill = value > 0)) +
geom_col() +
facet_wrap(~component, scales = "free_y") +
scale_y_reordered() +
labs(
x = "Absolute value of contribution",
y = NULL, fill = "Positive?"
) +
scale_fill_fish_d(option = "Antennarius_commerson")
juice(ranking_prep)
tidied_pca %>%
filter(component %in% c("PC1", "PC2", "PC3", "PC4")) %>%
group_by(component) %>%
top_n(10, abs(value)) %>%
ungroup() %>%
mutate(terms = reorder_within(terms, abs(value), component)) %>%
ggplot(aes(abs(value), terms, fill = value > 0)) +
geom_col() +
facet_wrap(~component, scales = "free_y") +
scale_y_reordered() +
labs(
x = "Absolute value of contribution",
y = NULL, fill = "Positive?"
) +
scale_fill_fish_d(option = "Antennarius_commerson")
tidied_pca %>%
mutate(component = fct_inorder(component)) %>%
ggplot(aes(value, terms, fill = terms)) +
geom_col(show.legend = FALSE) +
facet_wrap(~component) +
labs(y = NULL) +
scale_fill_fish_d(option = "Antennarius_commerson")
tidied_pca %>%
filter(component %in% c("PC1", "PC2", "PC3", "PC4")) %>%
group_by(component) %>%
top_n(10, abs(value)) %>%
ungroup() %>%
mutate(terms = reorder_within(terms, abs(value), component)) %>%
ggplot(aes(abs(value), terms, fill = value > 0)) +
geom_col() +
facet_wrap(~component, scales = "free_y") +
scale_y_reordered() +
labs(
x = "Absolute value of contribution",
y = NULL, fill = "Positive?"
) +
scale_fill_fish_d(option = "Antennarius_commerson")
tidied_pca %>%
filter(component %in% c("PC1", "PC2", "PC3", "PC4")) %>%
group_by(component) %>%
top_n(10, abs(value)) %>%
ungroup() %>%
mutate(terms = reorder_within(terms, abs(value), component)) %>%
ggplot(aes(abs(value), terms, fill = value > 0)) +
geom_col() +
facet_wrap(~component, scales = "free_y") +
scale_y_reordered() +
labs(
x = "Absolute value of contribution",
y = NULL, fill = "Positive?"
) +
scale_fill_fish_d(option = "Antennarius_commerson")
tidied_pca %>%
filter(component %in% c("PC1", "PC2", "PC3", "PC4")) %>%
group_by(component) %>%
top_n(10, abs(value)) %>%
ungroup() %>%
mutate(terms = reorder_within(terms, abs(value), component)) %>%
ggplot(aes(abs(value), terms, fill = value > 0)) +
geom_col() +
facet_wrap(~component, scales = "free_y") +
scale_y_reordered() +
labs(
x = "Absolute value of contribution",
y = NULL, fill = "Positive?"
) +
scale_fill_fish_d(option = "Antennarius_commerson")
juice(ranking_prep) %>%
ggplot(aes(PC1, PC2, label = title)) +
geom_point(alpha = 0.2) +
geom_text(check_overlap = TRUE, family = "IBMPlexSans")
juice(ranking_prep)
tidied_pca %>%
filter(component %in% c("PC1", "PC2", "PC3", "PC4")) %>%
group_by(component) %>%
top_n(10, abs(value)) %>%
ungroup() %>%
mutate(terms = reorder_within(terms, abs(value), component)) %>%
ggplot(aes(abs(value), terms, fill = value > 0)) +
geom_col() +
facet_wrap(~component, scales = "free_y") +
scale_y_reordered() +
labs(
x = "Absolute value of contribution",
y = NULL, fill = "Positive?"
) +
scale_fill_fish_d(option = "Antennarius_commerson")
tidied_pca %>%
filter(component %in% c("PC1", "PC2", "PC3", "PC4")) %>%
group_by(component) %>%
top_n(10, abs(value)) %>%
ungroup() %>%
mutate(terms = reorder_within(terms, abs(value), component)) %>%
ggplot(aes(abs(value), terms, fill = value > 0)) +
geom_col() +
facet_wrap(~component, scales = "free_y") +
scale_y_reordered() +
labs(
x = "Absolute value of contribution",
y = NULL, fill = "Positive?"
)
tidied_pca %>%
filter(component %in% c("PC1", "PC2", "PC3", "PC4")) %>%
group_by(component) %>%
top_n(6, abs(value)) %>%
ungroup() %>%
mutate(terms = reorder_within(terms, abs(value), component)) %>%
ggplot(aes(abs(value), terms, fill = value > 0)) +
geom_col() +
facet_wrap(~component, scales = "free_y") +
scale_y_reordered() +
labs(
x = "Absolute value of contribution",
y = NULL, fill = "Positive?"
)
juice(ranking_prep) %>%
ggplot(aes(PC1, PC2, label = title)) +
geom_point(alpha = 0.2) +
geom_text(check_overlap = TRUE, family = "IBMPlexSans")
theme_minimal
theme_minimal()
theme_minimal
library(tidyverse)
