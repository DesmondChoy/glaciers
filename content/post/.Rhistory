set_wd <- function() {
library(rstudioapi)
current_path <- getActiveDocumentContext()$path
setwd(dirname(current_path ))
print( getwd() )
}
getwd()
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
fig.width = 15,
fig.height = 12)
Sectors <- read_xlsx("https://github.com/DesmondChoy/glaciers/blob/master/content/post/Sectors.xlsx", na = "NA")
library(readxl) #data importing
library(tidyverse) #data wrangling
library(magrittr) #data wrangling
library(lubridate) #date manipulation
library(hrbrthemes) #ggplot themes
library(ggrepel) #ggplot identification of data points
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
fig.width = 15,
fig.height = 12)
library(readxl) #data importing
library(tidyverse) #data wrangling
library(magrittr) #data wrangling
library(lubridate) #date manipulation
library(hrbrthemes) #ggplot themes
library(ggrepel) #ggplot identification of data points
Sectors <- read_xlsx("https://github.com/DesmondChoy/glaciers/blob/master/content/post/Sectors.xlsx", na = "NA")
?readxl::read_xlsx
Sectors <- read_xlsx("github.com/DesmondChoy/glaciers/blob/master/content/post/Sectors.xlsx", na = "NA")
Sectors <- read_excel("https://github.com/DesmondChoy/glaciers/blob/master/content/post/Sectors.xlsx")
Sectors <- read_xlsx("Sectors", na = "NA")
Sectors <- read_xlsx("Sectors.xlsx", na = "NA")
Sectors <- Sectors[-c(1:3),]
Periods <- read_xlsx("Periods.xlsx", na = "NA")
Periods <- Periods[-c(1:3),]
Energy <- left_join(Sectors, Periods)
Energy <- distinct(Energy, CUSIP, .keep_all = TRUE)
names(Energy) <- tolower(gsub("\\s", "\\.", names(Energy)))
blogdown:::serve_site()
Energy %>%
filter(ticker %in% c("TOPTB", "VLO")) %>%
select(ticker, security, cusip, bclass.level.4.classification.name, bloomberg.composite.rating)
knitr::opts_chunk$set(
message = FALSE,
warning = FALSE,
fig.width = 15,
fig.height = 12)
library(readxl) #data importing
library(tidyverse) #data wrangling
library(magrittr) #data wrangling
library(lubridate) #date manipulation
library(hrbrthemes) #ggplot themes
library(ggrepel) #ggplot identification of data points
Sectors <- read_xlsx("Sectors.xlsx", na = "NA")
Sectors <- Sectors[-c(1:3),]
Periods <- read_xlsx("Periods.xlsx", na = "NA")
Periods <- Periods[-c(1:3),]
Energy <- left_join(Sectors, Periods)
Energy <- distinct(Energy, CUSIP, .keep_all = TRUE)
names(Energy) <- tolower(gsub("\\s", "\\.", names(Energy)))
library(skimr)
skim(Energy)
Energy$bloomberg.composite.rating <-
as_factor(Energy$bloomberg.composite.rating) %>%
factor(levels = c("AA+", "AA", "AA-", "A+", "A", "A-", "BBB+", "BBB", "BBB-", "BB+", "NR"))
Energy$ticker <- str_extract(Energy$security, "^\\w+")
Energy$year <- str_extract(Energy$security, "\\d\\d$")
Energy$coupon <- str_extract(Energy$security, "\\s.+\\s")
Energy$maturity <- as.numeric((mdy(str_extract(Energy$security, "\\d+/.+$")) - today())/365)
Energy$`moody's.rating` <- as_factor(Energy$`moody's.rating`)
Energy$`s&p.rating` <- as_factor(Energy$`s&p.rating`)
Energy$crncy <- as_factor(Energy$crncy)
Energy$bclass.level.4.classification.name <-
as_factor(Energy$bclass.level.4.classification.name) %>%
factor(
levels = c(
"Integrated",
"Independent",
"Midstream",
"Refining",
"Oil Field Services",
"Government Owned, No Guarantee"
)
Energy <- Energy %>%
filter(!ticker %in% c("PAA", "BHI", "SLB", "HAL"))
Energy %>%
filter(ticker %in% c("SINOPE", "CNPCCH", "PETMK", "PTTTB", "STOAU", "CNOOC", "TOPTB", "VLO")) %>%
group_by(ticker, bclass.level.4.classification.name) %>%
summarise(n = n()) %>%
arrange(bclass.level.4.classification.name)
Energy %>%
filter(ticker %in% c("TOPTB", "VLO")) %>%
select(ticker, security, cusip, bclass.level.4.classification.name, bloomberg.composite.rating)
Energy %>%
filter(ticker %in% c("TOPTB", "VLO")) %>%
select(ticker, security, cusip, bclass.level.4.classification.name, bloomberg.composite.rating) %>%
knitr::kable()
