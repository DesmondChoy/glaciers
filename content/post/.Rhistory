strip.text = element_text(face = "bold", size = 15),
legend.title = element_text(face = "bold", size = 15)
)
# Chunk 15: Players With And Without Contracts
labels <-
c("D" = "Defender",
"DM" = "Defensive Midfielder",
"M" = "Midfielder",
"AM" = "Attacking Midfielder",
"F" = "Forward",
"ST" = "Striker")
data %>%
mutate(contracted = case_when(is.na(team_position) ~ "No",
TRUE ~ "Yes")) %>%
pivot_longer(pace:physic, names_to = "skills", values_to = "values") %>%
filter(!position == "GK") %>%
mutate(skills = reorder_within(skills, values, position)) %>%
ggplot(aes(values, skills, fill = contracted)) +
geom_boxplot() +
geom_text(
data = . %>%
group_by(position, skills) %>%
mutate(percentile = values > quantile(values, 0.99999, na.rm = TRUE)) %>%
filter(percentile == 1),
aes(label = paste(short_name, "\n", str_wrap(club, width = 15), sep = ""), colour = position),
size = 3,
nudge_x = -3,
nudge_y = -0.2,
check_overlap = TRUE,
fontface = "bold",
vjust = "bottom-left", hjust = "bottom-left",
show.legend = F
) +
facet_wrap( ~ position, scales = "free_y", labeller = as_labeller(labels)) +
scale_y_reordered() +
scale_fill_fish_d(option = "Antennarius_commerson") +
labs(
x = "Values",
y = "Skills",
fill = "Under Contract?",
title = "Players With And Without Contracts In FIFA 20 - How Do They Compare?",
subtitle = "Using traits like dribbling, passing and shooting, players with only international appearances and no club contracts don't appear to be less skilled.\nHowever there are significantly more outliers among players with contracts - we highlight the extreme outliers and their clubs.",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
strip.background = element_blank(),
strip.text = element_text(face = "bold", size = 15),
legend.title = element_text(face = "bold", size = 15),
legend.position = "top"
)
# Chunk 16: player tags and traits
data %>%
select(short_name, club, position, player_tags, player_traits) %>%
na.omit() %>%
sample_n(10)
# Chunk 17: pairwise corr
library(widyr)
library(igraph)
library(ggraph)
corr <- data %>%
select(short_name, club, position, player_tags, player_traits) %>%
separate(player_tags, paste("tag", 1:10, sep = ""), sep = ", ") %>%
separate(player_traits, paste("trait", 1:8, sep = ""), sep = ", ") %>%
pivot_longer(tag1:trait8, names_to = "tag", values_to = "description", values_drop_na = T) %>%
mutate(description = str_replace(description, "#", "")) %>%
filter(!str_detect(description, "CPU AI Only")) %>%
group_by(description) %>%
filter(n() > 100) %>%
pairwise_cor(description, short_name, sort = TRUE)
corr
# Chunk 18: network graph
set.seed(2020)
corr %>%
filter(correlation > .03) %>%
graph_from_data_frame() %>%
ggraph(layout = "fr") +
geom_edge_link(aes(edge_alpha = correlation), show.legend = FALSE) +
geom_node_point(color = "lightblue", size = 5) +
geom_node_text(
aes(label = name),
repel = TRUE,
fontface = "bold",
vjust = -1,
hjust = -0.2
) +
labs(
title = "Visualizing Correlation Of Players' Tags and Traits With A Network Graph",
subtitle = "Crowd favourites tend to be selfish acrobats that excel at beating offside traps and arguing with officials\nDoes any particular player come to mind?",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
strip.background = element_blank(),
strip.text = element_text(face = "bold", size = 15),
)
# Chunk 19: age
library(GGally)
data %>%
mutate(age_segment = case_when(
age < 23 ~ "Age<23",
between(age, 23, 25) ~ "Age 23-25",
between(age, 26, 29) ~ "Age 26-29",
TRUE ~ "Age>29")) %>%
select(age, value_eur, wage_eur, overall, potential, age_segment) %>%
ggscatmat(columns = 1:5, color = "age_segment") +
scale_color_fish_d(option = "Antennarius_commerson") +
labs(title = "Players Aged <23 Are Positively Correlated With Higher Value, Wages and Overall Score",
subtitle = "Beyond 29 years of age, we start to see negative correlation",
caption = "Source: FIFA 20 Complete Player Data Set")
# Chunk 20: continents
#adding continents
geography <- data %>%
mutate(continent = countrycode(nationality,
origin = "country.name",
destination = "continent")) %>%
#place Brexit countries back into Europe
mutate(continent = replace_na(continent, "Europe"))
geography %>%
select(short_name, club, nationality, continent) %>%
sample_n(10)
# Chunk 21: pot_dollar
#identify the clubs with the highest potential per wage dollar paid
list <- geography %>%
#remove players with no clubs and no wages paid, and some players with 0 value
filter(!is.na(team_position),
value_eur > 0) %>%
select(short_name, club, potential, value_eur, nationality, continent) %>%
#each player's potential per dollar of wages paid. Higher is better.
mutate(pot_per_dollar = potential / value_eur) %>%
group_by(club) %>%
summarise(total_pot = sum(pot_per_dollar)) %>%
arrange(desc(total_pot)) %>%
head(20)
geography %>%
#filter data set for clubs in list
filter(club %in% list$club,
value_eur > 0) %>%
select(short_name, club, potential, value_eur, nationality, continent) %>%
mutate(
pot_per_dollar = potential / value_eur,
club = fct_reorder(club, pot_per_dollar, .fun = sum)
) %>%
ggplot(aes(club, pot_per_dollar)) +
geom_col(aes(fill = continent)) +
coord_flip() +
scale_fill_fish_d(option = "Antennarius_commerson") +
labs(
x = "Club",
y = "Club's Total Potential Per Value",
fill = "Continent",
title = "Bargain Hunting At Clubs - Scouting For High Potential Players At The Lowest Price",
subtitle = "Sorted by this metric, we can see promising clubs can be found in Asia and Europe leagues.",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
strip.background = element_blank(),
strip.text = element_text(face = "bold", size = 15),
legend.title = element_text(face = "bold")
)
# Chunk 22: age quantiles
library(skimr)
geography$age %>%
skim()
# Chunk 23: recipe
library(tidymodels)
pca_rec <- geography %>%
filter(!is.na(team_jersey_number), !position == "GK") %>%
mutate(age_segment = case_when(
age < 23 ~ "Age<23",
between(age, 23, 25) ~ "Age 23-25",
between(age, 26, 29) ~ "Age 26-29",
TRUE ~ "Age>29")) %>%
select(
#identifiers
sofifa_id, short_name, long_name, club, value_eur,
#categorical
preferred_foot, position, continent, age_segment,
#numeric
overall:potential, team_jersey_number, skill_moves,
pace:physic, attacking_crossing:defending_sliding_tackle
) %>%
recipe( ~ .) %>%
update_role(sofifa_id, short_name, long_name, club, value_eur, new_role = "id") %>%
step_dummy(preferred_foot, position, continent, age_segment) %>%
step_normalize(all_predictors()) %>%
step_pca(all_predictors())
# Chunk 24: prep
pca_prep <- pca_rec %>%
prep()
pca_prep
# Chunk 25: visual high-level
#tidy(df,3) lets us extract the third recipe step i.e. step_pca
tidied_pca <- tidy(pca_prep, 3)
tidied_pca %>%
filter(component %in% paste0("PC", 1:4)) %>%
mutate(component = fct_inorder(component)) %>%
ggplot(aes(value, terms, fill = terms)) +
geom_col(show.legend = FALSE) +
facet_wrap( ~ component, nrow = 1) +
scale_fill_fish_d(option = "Antennarius_commerson") +
labs(
x = "Value",
y = "Traits",
fill = "",
title = "PCA: A High-Level Overview Of The First Four Features Created",
subtitle = NULL,
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
strip.background = element_blank(),
strip.text = element_text(face = "bold", size = 15)
)
# Chunk 26: visual deep-dive
tidied_pca %>%
filter(component %in% paste0("PC", 1:4)) %>%
group_by(component) %>%
top_n(20, abs(value)) %>%
ungroup() %>%
mutate(terms = reorder_within(terms, abs(value), component)) %>%
ggplot(aes(abs(value), terms, fill = value > 0)) +
geom_col() +
facet_wrap(~component, scales = "free_y") +
scale_y_reordered() +
scale_fill_fish_d(option = "Antennarius_commerson") +
labs(
x = "Absolute Value of Contribution",
y = NULL,
fill = "Positive?",
title = "PCA: Visualizing The First Four Features (PC1-PC4) Created",
subtitle = "Interpretation: As PC1 gets more negative, it captures offensive midfielder/playmaker traits;\nPC3: Hallmarks of a classic striker (strength, finishing, shooting) vs Movement/Agility traits",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
strip.background = element_blank(),
strip.text = element_text(face = "bold", size = 15),
legend.title = element_text(face = "bold")
)
# Chunk 27: top50 most valuable
#Getting our top 50 valuable players ex GKs
valuable <- geography %>%
filter(!is.na(team_jersey_number),
!position == "GK") %>%
arrange(desc(value_eur)) %>%
select(long_name) %>%
slice(1:100)
juice(pca_prep) %>%
filter(long_name %in% valuable$long_name) %>%
left_join(geography %>% select(sofifa_id, position)) %>%
ggplot(aes(PC1, PC3, label = paste(
short_name, "\n", "(", str_wrap(club, width = 20), ")", "\n", "EUR", value_eur/1000000, "m", sep = ""))) +
geom_point(aes(color = position), alpha = 0.75, size = 5) +
geom_text(
check_overlap = TRUE,
vjust = "inward",
hjust = "inward",
size = 4,
fontface = "bold") +
scale_colour_fish_d(option = "Hypsypops_rubicundus") +
scale_x_continuous() +
labs(
x = "PC1",
y = "PC3",
color = "Position",
title = "FIFA 20: Top 100 Most Valuable Soccer Players (ex GKs) Mapped Against PC1 and PC3",
subtitle = "Offensive midfielders/playmakers are towards the left, defenders are mapped towards the right,\nStrikers can be found towards the top, while defensive roles with high movement scores are towards the bottom.",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
legend.title = element_text(face = "bold"),
legend.position = "top"
)
pot_dollar <- geography %>%
filter(!is.na(team_jersey_number),
!position == "GK",
value_eur > 0) %>%
mutate(pot_per_dollar = potential / value_eur) %>%
arrange(desc(pot_per_dollar)) %>%
select(long_name, pot_per_dollar) %>%
slice(1:100)
juice(pca_prep) %>%
filter(long_name %in% pot_dollar$long_name) %>%
left_join(geography %>% select(sofifa_id, position)) %>%
ggplot(aes(PC1, PC3, label = paste(
short_name, "\n", "(", str_wrap(club, width = 20), ")", "\n", "EUR", value_eur/1000, "k", sep = ""))) +
geom_point(aes(color = position), alpha = 0.75, size = 5) +
geom_text(
check_overlap = TRUE,
vjust = "inward",
hjust = "inward",
size = 4,
fontface = "bold"
) +
scale_colour_fish_d(option = "Hypsypops_rubicundus") +
labs(
x = "PC1",
y = "PC3",
color = "Position",
title = "FIFA 20: Top 100 Soccer Players (ex GKs) With The Highest Potential Per Value Dollar",
subtitle = "Note: x-axis has shifted significantly from the previous chart, with PC1 indicating a selection bias towards players with defensive traits.",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
legend.title = element_text(face = "bold"),
legend.position = "top"
)
juice(pca_prep) %>%
filter(long_name %in% pot_dollar$long_name) %>%
left_join(geography %>% select(sofifa_id, position)) %>%
ggplot(aes(PC1, PC3, label = paste(
short_name, "\n", "(", str_wrap(club, width = 20), ")", "\n", "EUR", value_eur/1000, "k", sep = ""))) +
geom_point(aes(color = position), alpha = 0.75, size = 5) +
geom_text(
vjust = "inward",
hjust = "inward",
size = 4,
fontface = "bold"
) +
scale_colour_fish_d(option = "Hypsypops_rubicundus") +
labs(
x = "PC1",
y = "PC3",
color = "Position",
title = "FIFA 20: Top 100 Soccer Players (ex GKs) With The Highest Potential Per Value Dollar",
subtitle = "Note: x-axis has shifted significantly from the previous chart, with PC1 indicating a selection bias towards players with defensive traits.",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
legend.title = element_text(face = "bold"),
legend.position = "top"
)
short_name, "\n", "(", str_wrap(club, width = 20), ")", "\n", "EUR", value_eur/1000, "k", sep = ""))) +
geom_point(aes(color = position), alpha = 0.75, size = 5) +
geom_text(
juice(pca_prep) %>%
filter(long_name %in% pot_dollar$long_name) %>%
left_join(geography %>% select(sofifa_id, position)) %>%
ggplot(aes(PC1, PC3, label = paste(
short_name, "\n", "(", str_wrap(club, width = 20), ")", "\n", "EUR", value_eur/1000, "k", sep = ""))) +
geom_point(aes(color = position), alpha = 0.75, size = 5) +
geom_text(
check_overlap = TRUE,
vjust = "inward",
hjust = "inward",
size = 4,
fontface = "bold"
) +
scale_colour_fish_d(option = "Hypsypops_rubicundus") +
labs(
x = "PC1",
y = "PC3",
color = "Position",
title = "FIFA 20: Top 100 Soccer Players (ex GKs) With The Highest Potential Per Value Dollar",
subtitle = "Note: x-axis has shifted significantly from the previous chart, with PC1 indicating a selection bias towards players with defensive traits.",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
legend.title = element_text(face = "bold"),
legend.position = "top"
)
short_name, "\n", "(", str_wrap(club, width = 20), ")", "\n", "EUR", value_eur/1000, "k", sep = ""))) +
geom_point(aes(color = position), alpha = 0.75, size = 5) +
geom_text(
juice(pca_prep) %>%
filter(long_name %in% pot_dollar$long_name) %>%
left_join(geography %>% select(sofifa_id, position)) %>%
ggplot(aes(PC1, PC3, label = paste(
short_name, "\n", "(", str_wrap(club, width = 20), ")", "\n", "EUR", value_eur/1000, "k", sep = ""))) +
geom_point(aes(color = position), alpha = 0.75, size = 5) +
geom_text(
check_overlap = TRUE,
vjust = "inward",
hjust = "outward",
size = 4,
fontface = "bold"
) +
scale_colour_fish_d(option = "Hypsypops_rubicundus") +
labs(
x = "PC1",
y = "PC3",
color = "Position",
title = "FIFA 20: Top 100 Soccer Players (ex GKs) With The Highest Potential Per Value Dollar",
subtitle = "Note: x-axis has shifted significantly from the previous chart, with PC1 indicating a selection bias towards players with defensive traits.",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
legend.title = element_text(face = "bold"),
legend.position = "top"
)
juice(pca_prep) %>%
filter(long_name %in% pot_dollar$long_name) %>%
left_join(geography %>% select(sofifa_id, position)) %>%
ggplot(aes(PC1, PC3, label = paste(
short_name, "\n", "(", str_wrap(club, width = 20), ")", "\n", "EUR", value_eur/1000, "k", sep = ""))) +
geom_point(aes(color = position), alpha = 0.75, size = 5) +
geom_text(
check_overlap = TRUE,
vjust = "inward",
hjust = "inward",
size = 4,
fontface = "bold"
) +
scale_colour_fish_d(option = "Hypsypops_rubicundus") +
labs(
x = "PC1",
y = "PC3",
color = "Position",
title = "FIFA 20: Top 100 Soccer Players (ex GKs) With The Highest Potential Per Value Dollar",
subtitle = "Note: x-axis has shifted significantly from the previous chart, with PC1 indicating a selection bias towards players with defensive traits.",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
legend.title = element_text(face = "bold"),
legend.position = "top"
)
juice(pca_prep) %>%
filter(long_name %in% pot_dollar$long_name) %>%
left_join(geography %>% select(sofifa_id, position)) %>%
ggplot(aes(PC1, PC3, label = paste(
short_name, "\n", "(", str_wrap(club, width = 20), ")", "\n", "EUR", value_eur/1000, "k", sep = ""))) +
geom_point(aes(color = position), alpha = 0.75, size = 5) +
geom_text(
check_overlap = TRUE,
vjust = "outward",
hjust = "inward",
size = 4,
fontface = "bold"
) +
scale_colour_fish_d(option = "Hypsypops_rubicundus") +
labs(
x = "PC1",
y = "PC3",
color = "Position",
title = "FIFA 20: Top 100 Soccer Players (ex GKs) With The Highest Potential Per Value Dollar",
subtitle = "Note: x-axis has shifted significantly from the previous chart, with PC1 indicating a selection bias towards players with defensive traits.",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
legend.title = element_text(face = "bold"),
legend.position = "top"
)
juice(pca_prep) %>%
filter(long_name %in% pot_dollar$long_name) %>%
left_join(geography %>% select(sofifa_id, position)) %>%
ggplot(aes(PC1, PC3, label = paste(
short_name, "\n", "(", str_wrap(club, width = 20), ")", "\n", "EUR", value_eur/1000, "k", sep = ""))) +
geom_point(aes(color = position), alpha = 0.75, size = 5) +
geom_text(
check_overlap = TRUE,
vjust = "inward",
hjust = "outward",
size = 4,
fontface = "bold"
) +
scale_colour_fish_d(option = "Hypsypops_rubicundus") +
labs(
x = "PC1",
y = "PC3",
color = "Position",
title = "FIFA 20: Top 100 Soccer Players (ex GKs) With The Highest Potential Per Value Dollar",
subtitle = "Note: x-axis has shifted significantly from the previous chart, with PC1 indicating a selection bias towards players with defensive traits.",
caption = "Source: FIFA 20 Complete Player Data Set"
) +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
legend.title = element_text(face = "bold"),
legend.position = "top"
)
data %>%
mutate(
age_segment = case_when(
age < 23 ~ "Age<23",
between(age, 23, 25) ~ "Age 23-25",
between(age, 26, 29) ~ "Age 26-29",
TRUE ~ "Age>29"
)
) %>%
select(age, value_eur, wage_eur, overall, potential, age_segment) %>%
ggscatmat(columns = 1:5, color = "age_segment") +
scale_color_fish_d(option = "Antennarius_commerson") +
labs(title = "Players Aged <23 Are Positively Correlated With Higher Value, Wages and Overall Score",
subtitle = "Beyond 29 years of age, we start to see negative correlation",
color = "Age Segment",
caption = "Source: FIFA 20 Complete Player Data Set") +
theme(
plot.title = element_text(face = "bold", size = 20),
plot.subtitle = element_text(size = 17),
legend.title = element_text(face = "bold")
)
blogdown:::serve_site()
